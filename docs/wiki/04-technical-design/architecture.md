# ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ—ï¸ æ¶æ„æ€»è§ˆ

### ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¡¨ç°å±‚ (Presentation)                 â”‚
â”‚  EvaluationPage, ARLightBox, ScoreCard, etc.            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡é€»è¾‘å±‚ (Business)    â”‚    â”‚  Hooks & Zustand Store    â”‚
â”‚   useEvaluation           â”‚    â”‚  Global State Management  â”‚
â”‚   useImageUpload          â”‚    â”‚  useARGestures           â”‚
â”‚   useHistory              â”‚    â”‚  useScore                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœåŠ¡å±‚ (Services)                 â”‚          â”‚
â”‚  aiService.ts (Gemini API)                   â”‚          â”‚
â”‚  firebaseService.ts (Firestore, Storage)    â”‚          â”‚
â”‚  imageService.ts (å›¾ç‰‡å¤„ç†)                   â”‚          â”‚
â”‚  svgPathService.ts (SVGç»˜åˆ¶)                â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               å¤–éƒ¨æœåŠ¡ (External Services)                 â”‚
â”‚  Gemini 2.0 Flash API          Google AI Studio          â”‚
â”‚  Firebase (Firestore, Storage) Google Cloud             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•°æ®æµ

### è¯„ä¼°æµç¨‹æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ
  â”‚
  â”œâ”€â†’ ä¸Šä¼ å›¾ç‰‡
  â”‚   â”‚
  â”‚   â””â”€â†’ ImageService (å‹ç¼©ã€éªŒè¯)
  â”‚       â”‚
  â”‚       â”œâ”€â†’ æœ¬åœ°é¢„è§ˆ (ARLightBox)
  â”‚       â””â”€â†’ Base64ç¼–ç 
  â”‚
  â”œâ”€â†’ æäº¤è¯„ä¼°
  â”‚   â”‚
  â”‚   â””â”€â†’ AIService (Gemini API)
  â”‚       â”‚
  â”‚       â”œâ”€â†’ å››ç»´è¯„åˆ†è®¡ç®—
  â”‚       â”œâ”€â†’ è¯„çº§è¯„å®š
  â”‚       â””â”€â†’ å»ºè®®ç”Ÿæˆ
  â”‚
  â”œâ”€â†’ æ˜¾ç¤ºç»“æœ
  â”‚   â”‚
  â”‚   â””â”€â†’ ScoreCardç»„ä»¶
  â”‚       â”œâ”€â†’ è¯„åˆ†å±•ç¤º
  â”‚       â”œâ”€â†’ å»ºè®®åˆ—è¡¨
  â”‚       â””â”€â†’ é¼“åŠ±è¯­è¨€
  â”‚
  â””â”€â†’ ä¿å­˜æ•°æ®
      â”‚
      â””â”€â†’ FirebaseService
          â”œâ”€â†’ Firestore (è¯„ä¼°è®°å½•)
          â””â”€â†’ ç”¨æˆ·åé¦ˆ
```

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„ç»†èŠ‚

### src/ ç›®å½•è¯¦è§£

```
src/
â”œâ”€â”€ components/                    # Reactç»„ä»¶åº“
â”‚   â”œâ”€â”€ ARLightBox.tsx            # ARé€å°ç»„ä»¶ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ ARLightBox.module.css
â”‚   â”œâ”€â”€ ScoreCard.tsx             # è¯„åˆ†å¡ç‰‡
â”‚   â”œâ”€â”€ ScoreCard.module.css
â”‚   â”œâ”€â”€ SuggestionPanel.tsx       # å»ºè®®é¢æ¿
â”‚   â”œâ”€â”€ FeedbackForm.tsx          # åé¦ˆè¡¨å•
â”‚   â”œâ”€â”€ Button.tsx                # é€šç”¨æŒ‰é’®
â”‚   â”œâ”€â”€ Loading.tsx               # åŠ è½½åŠ¨ç”»
â”‚   â””â”€â”€ index.ts                  # å¯¼å‡ºæ‰€æœ‰ç»„ä»¶
â”‚
â”œâ”€â”€ pages/                         # é¡µé¢çº§ç»„ä»¶
â”‚   â”œâ”€â”€ EvaluationPage.tsx        # è¯„ä¼°é¡µé¢ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ EvaluationPage.module.css
â”‚   â”œâ”€â”€ HomePage.tsx              # é¦–é¡µ
â”‚   â””â”€â”€ HistoryPage.tsx           # å†å²è®°å½•
â”‚
â”œâ”€â”€ services/                      # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ aiService.ts              # Gemini APIé›†æˆ
â”‚   â”‚   â”œâ”€â”€ initializeAI()
â”‚   â”‚   â”œâ”€â”€ evaluateHandwriting()
â”‚   â”‚   â”œâ”€â”€ parseEvaluationResult()
â”‚   â”‚   â””â”€â”€ calculateTotalScore()
â”‚   â”‚
â”‚   â”œâ”€â”€ firebaseService.ts        # Firebaseåˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ initializeFirebase()
â”‚   â”‚   â”œâ”€â”€ saveEvaluation()
â”‚   â”‚   â”œâ”€â”€ getEvaluationHistory()
â”‚   â”‚   â””â”€â”€ saveFeedback()
â”‚   â”‚
â”‚   â”œâ”€â”€ imageService.ts           # å›¾ç‰‡å¤„ç†
â”‚   â”‚   â”œâ”€â”€ fileToBase64()
â”‚   â”‚   â”œâ”€â”€ compressImage()
â”‚   â”‚   â”œâ”€â”€ validateImage()
â”‚   â”‚   â””â”€â”€ resizeImage()
â”‚   â”‚
â”‚   â””â”€â”€ svgPathService.ts         # SVGç»˜åˆ¶
â”‚       â”œâ”€â”€ drawPath()
â”‚       â”œâ”€â”€ animatePath()
â”‚       â””â”€â”€ getStrokePath()
â”‚
â”œâ”€â”€ hooks/                         # è‡ªå®šä¹‰React Hooks
â”‚   â”œâ”€â”€ useEvaluation.ts          # è¯„ä¼°é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ useState (loading, result, error)
â”‚   â”‚   â”œâ”€â”€ useEffect (åˆå§‹åŒ–)
â”‚   â”‚   â””â”€â”€ evaluate() æ–¹æ³•
â”‚   â”‚
â”‚   â”œâ”€â”€ useImageUpload.ts         # å›¾ç‰‡ä¸Šä¼ 
â”‚   â”‚   â”œâ”€â”€ useState (image, preview)
â”‚   â”‚   â”œâ”€â”€ handleUpload()
â”‚   â”‚   â””â”€â”€ validateAndCompress()
â”‚   â”‚
â”‚   â”œâ”€â”€ useARGestures.ts          # ARæ‰‹åŠ¿
â”‚   â”‚   â”œâ”€â”€ useState (scale, rotation, opacity)
â”‚   â”‚   â””â”€â”€ handlePinch(), handleRotate()
â”‚   â”‚
â”‚   â””â”€â”€ useHistory.ts             # å†å²è®°å½•
â”‚       â”œâ”€â”€ useState (evaluations)
â”‚       â”œâ”€â”€ useEffect (åŠ è½½å†å²)
â”‚       â””â”€â”€ fetchHistory()
â”‚
â”œâ”€â”€ types/                         # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ index.ts                  # å…¬å…±ç±»å‹
â”‚   â”‚   â”œâ”€â”€ ScoreObject
â”‚   â”‚   â”œâ”€â”€ EvaluationResult
â”‚   â”‚   â””â”€â”€ UserFeedback
â”‚   â”‚
â”‚   â”œâ”€â”€ ar.ts                     # ARç›¸å…³ç±»å‹
â”‚   â”‚   â”œâ”€â”€ ARGestureEvent
â”‚   â”‚   â”œâ”€â”€ ARTransform
â”‚   â”‚   â””â”€â”€ ARState
â”‚   â”‚
â”‚   â”œâ”€â”€ evaluation.ts             # è¯„ä¼°ç›¸å…³ç±»å‹
â”‚   â”‚   â”œâ”€â”€ ScoreObject
â”‚   â”‚   â”œâ”€â”€ SuggestionItem
â”‚   â”‚   â””â”€â”€ EvaluationLevel
â”‚   â”‚
â”‚   â””â”€â”€ firebase.ts               # Firebaseç›¸å…³ç±»å‹
â”‚       â”œâ”€â”€ FirebaseUser
â”‚       â”œâ”€â”€ EvaluationRecord
â”‚       â””â”€â”€ FeedbackRecord
â”‚
â”œâ”€â”€ stores/                        # Zustandå…¨å±€çŠ¶æ€
â”‚   â”œâ”€â”€ evaluationStore.ts        # è¯„ä¼°çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ currentResult
â”‚   â”‚   â”œâ”€â”€ evaluationHistory
â”‚   â”‚   â””â”€â”€ actions
â”‚   â”‚
â”‚   â”œâ”€â”€ uiStore.ts                # UIçŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ loading
â”‚   â”‚   â”œâ”€â”€ error
â”‚   â”‚   â””â”€â”€ notifications
â”‚   â”‚
â”‚   â””â”€â”€ userStore.ts              # ç”¨æˆ·çŠ¶æ€
â”‚       â”œâ”€â”€ userId
â”‚       â”œâ”€â”€ preferences
â”‚       â””â”€â”€ statistics
â”‚
â”œâ”€â”€ styles/                        # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ globals.css               # å…¨å±€é‡ç½®
â”‚   â”œâ”€â”€ variables.css             # CSSå˜é‡
â”‚   â”‚   â”œâ”€â”€ --color-primary
â”‚   â”‚   â”œâ”€â”€ --color-success
â”‚   â”‚   â””â”€â”€ --spacing-unit
â”‚   â”‚
â”‚   â””â”€â”€ animations.css            # åŠ¨ç”»å®šä¹‰
â”‚       â”œâ”€â”€ @keyframes fadeIn
â”‚       â”œâ”€â”€ @keyframes slideUp
â”‚       â””â”€â”€ @keyframes pulse
â”‚
â”œâ”€â”€ utils/                         # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ constants.ts              # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ SCORING_WEIGHTS
â”‚   â”‚   â”œâ”€â”€ MAX_IMAGE_SIZE
â”‚   â”‚   â””â”€â”€ EVALUATION_LEVELS
â”‚   â”‚
â”‚   â”œâ”€â”€ helpers.ts                # è¾…åŠ©å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ formatScore()
â”‚   â”‚   â”œâ”€â”€ getScoreLevel()
â”‚   â”‚   â””â”€â”€ generateSuggestions()
â”‚   â”‚
â”‚   â””â”€â”€ validators.ts             # éªŒè¯å‡½æ•°
â”‚       â”œâ”€â”€ validateImage()
â”‚       â”œâ”€â”€ validateScore()
â”‚       â””â”€â”€ validateEmail()
â”‚
â”œâ”€â”€ App.tsx                        # ä¸»åº”ç”¨ç»„ä»¶
â”œâ”€â”€ App.css                        # Appæ ·å¼
â”œâ”€â”€ main.tsx                       # åº”ç”¨å…¥å£
â””â”€â”€ vite-env.d.ts                # Viteç±»å‹å£°æ˜
```

### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

#### EvaluationPage.tsx (æ ¸å¿ƒé¡µé¢)

```typescript
export default function EvaluationPage() {
  // çŠ¶æ€ç®¡ç†
  const { image, imageBase64, loading, result } = useEvaluation();
  const { scale, opacity } = useARGestures();
  
  // äº‹ä»¶å¤„ç†
  const handleImageUpload = async (file: File) => { ... }
  const handleEvaluate = async () => { ... }
  const handleFeedback = async (helpful: boolean) => { ... }
  
  return (
    <div className="evaluation-container">
      {/* ä¸‰é˜¶æ®µUI */}
      {!result ? <UploadPhase /> : <ResultPhase />}
    </div>
  )
}
```

#### AIService.ts (AIé›†æˆ)

```typescript
export async function evaluateHandwriting(
  imageBase64: string
): Promise<EvaluationResult> {
  // 1. è°ƒç”¨Gemini API
  // 2. è§£æç»“æœ
  // 3. è®¡ç®—æ€»åˆ†
  // 4. ç”Ÿæˆå»ºè®®
}
```

#### FirebaseService.ts (åç«¯æœåŠ¡)

```typescript
export async function saveEvaluation(
  evaluation: EvaluationResult
): Promise<string> {
  // 1. ä¸Šä¼ å›¾ç‰‡åˆ°Storage
  // 2. ä¿å­˜è¯„ä¼°è®°å½•åˆ°Firestore
  // 3. è¿”å›è¯„ä¼°ID
}
```

## ğŸ”Œ æ¥å£è®¾è®¡

### ç»„ä»¶é€šä¿¡æ–¹å¼

#### Propsä¼ é€’ï¼ˆçˆ¶â†’å­ï¼‰
```typescript
<ScoreCard
  brushQuality={22}
  structureAnalysis={28}
  strokeConnection={12}
  overallEvaluation={20}
/>
```

#### äº‹ä»¶å›è°ƒï¼ˆå­â†’çˆ¶ï¼‰
```typescript
<Button
  onClick={() => handleEvaluate()}
  disabled={!imageBase64}
/>
```

#### å…¨å±€çŠ¶æ€ï¼ˆZustandï¼‰
```typescript
const useEvaluationStore = create((set) => ({
  currentResult: null,
  setResult: (result) => set({ currentResult: result })
}))
```

#### Context APIï¼ˆè·¨çº§é€šä¿¡ï¼‰
```typescript
<ThemeProvider value={theme}>
  <App />
</ThemeProvider>
```

## ğŸ” å®‰å…¨è®¾è®¡

### ç¯å¢ƒå˜é‡ä¿æŠ¤

```env
# .env.local (ä¸æäº¤åˆ°Git)
VITE_GEMINI_API_KEY=...
VITE_FIREBASE_API_KEY=...
```

### Firebaseè§„åˆ™

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // åªå…è®¸ç”¨æˆ·è®¿é—®è‡ªå·±çš„æ•°æ®
    match /evaluations/{userId}/records/{document=**} {
      allow read, write: if request.auth.uid == userId;
    }
  }
}
```

### APIé€Ÿç‡é™åˆ¶

```typescript
// åœ¨firebaseServiceä¸­å®ç°
const rateLimiter = new RateLimiter({
  maxRequests: 10,
  windowMs: 60000 // 1åˆ†é’Ÿ
})
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ä»£ç åˆ†å‰²

```typescript
// è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
const EvaluationPage = lazy(() => import('./pages/EvaluationPage'))
const HistoryPage = lazy(() => import('./pages/HistoryPage'))
```

### å›¾ç‰‡ä¼˜åŒ–

```typescript
// è‡ªåŠ¨å‹ç¼©
const compressed = await compressImage(file, {
  maxWidth: 1024,
  maxHeight: 1024,
  quality: 0.8
})
```

### ç¼“å­˜ç­–ç•¥

```typescript
// æœ¬åœ°ç¼“å­˜è¯„ä¼°ç»“æœ
localStorage.setItem('latestEvaluation', JSON.stringify(result))
```

---

**æœ€åæ›´æ–°**: 2025-12-04
